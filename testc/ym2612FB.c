#include <time.h>
#include <stdio.h>
#include "io.h"

// Set up channel 1 for FB=2, MT=1
unsigned char sample[]=
{
	0x00,0x30,0x01,//(1)
	0x00,0x34,0x01,//(1)
	0x00,0x38,0x01,//(1)
	0x00,0x3C,0x01,//(1)
	0x00,0x40,0x7F,//(1)
	0x00,0x44,0x7F,//(1)
	0x00,0x48,0x7F,//(1)
	0x00,0x4C,0x7F,//(1)
	0x00,0x50,0x1F,//(1)
	0x00,0x54,0x1F,//(1)
	0x00,0x58,0x1F,//(1)
	0x00,0x5C,0x1F,//(1)
	0x00,0x60,0x00,//(1)
	0x00,0x64,0x00,//(1)
	0x00,0x68,0x00,//(1)
	0x00,0x6C,0x00,//(1)
	0x00,0x70,0x00,//(1)
	0x00,0x74,0x00,//(1)
	0x00,0x78,0x00,//(1)
	0x00,0x7C,0x00,//(1)
	0x00,0x80,0x0F,//(1)
	0x00,0x84,0x0F,//(1)
	0x00,0x88,0x0F,//(1)
	0x00,0x8C,0x0F,//(1)
	0x00,0xB0,0x17,//(1)
	0x00,0xB4,0xC0,//(1)
	0x00,0x31,0x01,//(1)
	0x00,0x35,0x01,//(1)
	0x00,0x39,0x01,//(1)
	0x00,0x3D,0x01,//(1)
	0x00,0x41,0x7F,//(1)
	0x00,0x45,0x7F,//(1)
	0x00,0x49,0x7F,//(1)
	0x00,0x4D,0x7F,//(1)
	0x00,0x51,0x1F,//(1)
	0x00,0x55,0x1F,//(1)
	0x00,0x59,0x1F,//(1)
	0x00,0x5D,0x1F,//(1)
	0x00,0x61,0x00,//(1)
	0x00,0x65,0x00,//(1)
	0x00,0x69,0x00,//(1)
	0x00,0x6D,0x00,//(1)
	0x00,0x71,0x00,//(1)
	0x00,0x75,0x00,//(1)
	0x00,0x79,0x00,//(1)
	0x00,0x7D,0x00,//(1)
	0x00,0x81,0x0F,//(1)
	0x00,0x85,0x0F,//(1)
	0x00,0x89,0x0F,//(1)
	0x00,0x8D,0x0F,//(1)
	0x00,0xB1,0x17,//(1)
	0x00,0xB5,0xC0,//(1)
	0x00,0x32,0x01,//(1)
	0x00,0x36,0x01,//(1)
	0x00,0x3A,0x01,//(1)
	0x00,0x3E,0x01,//(1)
	0x00,0x42,0x7F,//(1)
	0x00,0x46,0x7F,//(1)
	0x00,0x4A,0x7F,//(1)
	0x00,0x4E,0x7F,//(1)
	0x00,0x52,0x1F,//(1)
	0x00,0x56,0x1F,//(1)
	0x00,0x5A,0x1F,//(1)
	0x00,0x5E,0x1F,//(1)
	0x00,0x62,0x00,//(1)
	0x00,0x66,0x00,//(1)
	0x00,0x6A,0x00,//(1)
	0x00,0x6E,0x00,//(1)
	0x00,0x72,0x00,//(1)
	0x00,0x76,0x00,//(1)
	0x00,0x7A,0x00,//(1)
	0x00,0x7E,0x00,//(1)
	0x00,0x82,0x0F,//(1)
	0x00,0x86,0x0F,//(1)
	0x00,0x8A,0x0F,//(1)
	0x00,0x8E,0x0F,//(1)
	0x00,0xB2,0x17,//(1)
	0x00,0xB6,0xC0,//(1)
	0x03,0x30,0x01,//(1)
	0x03,0x34,0x01,//(1)
	0x03,0x38,0x01,//(1)
	0x03,0x3C,0x01,//(1)
	0x03,0x40,0x7F,//(1)
	0x03,0x44,0x7F,//(1)
	0x03,0x48,0x7F,//(1)
	0x03,0x4C,0x7F,//(1)
	0x03,0x50,0x1F,//(1)
	0x03,0x54,0x1F,//(1)
	0x03,0x58,0x1F,//(1)
	0x03,0x5C,0x1F,//(1)
	0x03,0x60,0x00,//(1)
	0x03,0x64,0x00,//(1)
	0x03,0x68,0x00,//(1)
	0x03,0x6C,0x00,//(1)
	0x03,0x70,0x00,//(1)
	0x03,0x74,0x00,//(1)
	0x03,0x78,0x00,//(1)
	0x03,0x7C,0x00,//(1)
	0x03,0x80,0x0F,//(1)
	0x03,0x84,0x0F,//(1)
	0x03,0x88,0x0F,//(1)
	0x03,0x8C,0x0F,//(1)
	0x03,0xB0,0x17,//(1)
	0x03,0xB4,0xC0,//(1)
	0x03,0x31,0x01,//(1)
	0x03,0x35,0x01,//(1)
	0x03,0x39,0x01,//(1)
	0x03,0x3D,0x01,//(1)
	0x03,0x41,0x7F,//(1)
	0x03,0x45,0x7F,//(1)
	0x03,0x49,0x7F,//(1)
	0x03,0x4D,0x7F,//(1)
	0x03,0x51,0x1F,//(1)
	0x03,0x55,0x1F,//(1)
	0x03,0x59,0x1F,//(1)
	0x03,0x5D,0x1F,//(1)
	0x03,0x61,0x00,//(1)
	0x03,0x65,0x00,//(1)
	0x03,0x69,0x00,//(1)
	0x03,0x6D,0x00,//(1)
	0x03,0x71,0x00,//(1)
	0x03,0x75,0x00,//(1)
	0x03,0x79,0x00,//(1)
	0x03,0x7D,0x00,//(1)
	0x03,0x81,0x0F,//(1)
	0x03,0x85,0x0F,//(1)
	0x03,0x89,0x0F,//(1)
	0x03,0x8D,0x0F,//(1)
	0x03,0xB1,0x17,//(1)
	0x03,0xB5,0xC0,//(1)
	0x03,0x32,0x01,//(1)
	0x03,0x36,0x01,//(1)
	0x03,0x3A,0x01,//(1)
	0x03,0x3E,0x01,//(1)
	0x03,0x42,0x7F,//(1)
	0x03,0x46,0x7F,//(1)
	0x03,0x4A,0x7F,//(1)
	0x03,0x4E,0x7F,//(1)
	0x03,0x52,0x1F,//(1)
	0x03,0x56,0x1F,//(1)
	0x03,0x5A,0x1F,//(1)
	0x03,0x5E,0x1F,//(1)
	0x03,0x62,0x00,//(1)
	0x03,0x66,0x00,//(1)
	0x03,0x6A,0x00,//(1)
	0x03,0x6E,0x00,//(1)
	0x03,0x72,0x00,//(1)
	0x03,0x76,0x00,//(1)
	0x03,0x7A,0x00,//(1)
	0x03,0x7E,0x00,//(1)
	0x03,0x82,0x0F,//(1)
	0x03,0x86,0x0F,//(1)
	0x03,0x8A,0x0F,//(1)
	0x03,0x8E,0x0F,//(1)
	0x03,0xB2,0x17,//(1)
	0x03,0xB6,0xC0,//(1)

	0x00,0xA5,0x22,//(1)
	0x00,0xA1,0x6B,//(1)
	0x00,0x41,0x08,//(1)
	0x00,0x45,0x7E,//(1)
	0x00,0x49,0x7E,//(1)
	0x00,0x4D,0x7E,//(1)
	0x00,0x81,0x0F,//(1)
	0x00,0x85,0x0F,//(1)
	0x00,0x89,0x0F,//(1)
	0x00,0x8D,0x0F,//(1)
	0x00,0x28,0x01,//(1)
	0x00,0x81,0x0F,//(1)
	0x00,0x85,0x0F,//(1)
	0x00,0x89,0x0F,//(1)
	0x00,0x8D,0x0F,//(1)
};



#define IO_YM2612_STATUS		0x4D8
#define IO_YM2612_ADDR_CH0_2	0x4D8
#define IO_YM2612_DATA_CH0_2	0x4DA
#define IO_YM2612_ADDR_CH3_5	0x4DC
#define IO_YM2612_DATA_CH3_5	0x4DE

void WriteYM2612RegisterCH1to3(unsigned char reg,unsigned char data)
{
	while(0!=(0x80&IOReadByte(IO_YM2612_STATUS)))
	{
	}
	IOWriteByte(IO_YM2612_ADDR_CH0_2,reg);
	while(0!=(0x80&IOReadByte(IO_YM2612_STATUS)))
	{
	}
	IOWriteByte(IO_YM2612_DATA_CH0_2,data);
}

int main(void)
{
	int i;
	unsigned int FB=4,CONNECT=7,MULTI=3;

	for(i=0; i<sizeof(sample)/sizeof(sample[0]); i+=3)
	{
		if(0==sample[i])
		{
			if(0x30==sample[i+1])
			{
				WriteYM2612RegisterCH1to3(sample[i+1],(sample[i+2]&0xF0)|MULTI);
			}
			else
			{
				WriteYM2612RegisterCH1to3(sample[i+1],sample[i+2]);
			}
		}
	}

	WriteYM2612RegisterCH1to3(0x40,0);
	WriteYM2612RegisterCH1to3(0x44,127);
	WriteYM2612RegisterCH1to3(0x48,127);
	WriteYM2612RegisterCH1to3(0x4C,127);

	WriteYM2612RegisterCH1to3(0xB0,(FB<<3)|CONNECT);

	time_t t0=time(NULL);
	while(t0==time(NULL))
	{
	}
	t0=time(NULL);
	WriteYM2612RegisterCH1to3(0x28,0xF1); // Start Tone
	while(t0==time(NULL))
	{
	}
	WriteYM2612RegisterCH1to3(0x28,0x01); //(1)

	return 0;
}
